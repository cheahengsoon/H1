name: Shannon DAST Scan

on:
  workflow_dispatch:

jobs:
  shannon:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Download targets
        run: |
          echo "https://www.income.com.sg" > targets.txt

      - name: Clone Shannon
        run: |
          git clone https://github.com/KeygraphHQ/shannon.git
          cd shannon
          npm install

      - name: Run Shannon scan
        env:
          LLM_PROVIDER: anthropic
          ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        run: |
          cd shannon
          while read target; do
            echo "Scanning $target"
            node shannon --target "$target" --scope web --headless
          done < ../targets.txt
