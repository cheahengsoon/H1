name: Shannon Scan (Dynamic Scope)

on:
  workflow_dispatch:

jobs:
  shannon-scan:
    runs-on: ubuntu-latest
    timeout-minutes: 360   # allow long scans

    steps:
      - name: Fetch Scope List
        run: |
          curl -s https://raw.githubusercontent.com/rix4uni/scope/main/data/Yeswehack/yeswehack_inscope.txt \
          | tr ' ' '\n' \
          | sed '/^\s*$/d' \
          | grep -v '^\*\.' \
          > targets.txt

          echo "Total targets:"
          wc -l targets.txt

      - name: Run Shannon Scan Per Target
        run: |
          while read target; do
            echo "===== Scanning $target ====="

            npx --yes @keygraph/shannon scan \
              --target https://$target \
              --scope web,api \
              || true

          done < targets.txt
