name: 💥 Subdomain Discovery & HTTP Probing

on:
  schedule:
    - cron: '0 0 * * *' # Daily at midnight UTC
  workflow_dispatch:

jobs:
  subdomain-httpx-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: 📂 Create Output folder
        run: mkdir -p Output

      - name: 🛠️ Install Go, Subfinder, and httpx
        run: |
          sudo apt-get update
          sudo apt-get install -y golang-go
          # Add Go binaries to PATH
          echo "$HOME/go/bin" >> $GITHUB_PATH
          # Install Subfinder
          go install github.com/projectdiscovery/subfinder/v2/cmd/subfinder@latest
          # Install httpx
          go install github.com/projectdiscovery/httpx/cmd/httpx@latest

      - name: 🔎 Run subfinder
        run: |
          echo "Discovering subdomains..."
          subfinder -d gov.sg -o Output/subdomains.txt

      - name: 💥 Run httpx scan
        run: |
          echo "Probing live HTTP servers..."
          httpx -l Output/subdomains.txt -o Output/httpx_results.txt

      - name: 🖥️ List live URLs in Actions log
        run: |
          echo "Live URLs found:"
          if [ -s Output/httpx_results.txt ]; then
            cat Output/httpx_results.txt
          else
            echo "No live URLs found."
          fi

      - name: 📦 Upload results as artifact
        uses: actions/upload-artifact@v4
        with:
          name: httpx-results
          path: Output/httpx_results.txt
